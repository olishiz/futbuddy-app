{"version":3,"file":"default-src_app_pages_secure_payment_payment_page_ts.js","mappings":"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","sources":["./src/app/pages/secure/payment/payment.page.html","./src/app/pages/secure/payment/payment.page.ts"],"sourcesContent":["export default \"<ion-header>\\n    <ion-toolbar>\\n        <ion-buttons slot=\\\"start\\\">\\n            <ion-button (click)=\\\"cancel()\\\">\\n                Cancel\\n            </ion-button>\\n        </ion-buttons>\\n        <ion-title>\\n            Checkout\\n        </ion-title>\\n    </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n    <form [formGroup]=\\\"paymentForm\\\" (ngSubmit)=\\\"addPlayerToGame(this.game.id)\\\">\\n\\n        <div class=\\\"ion-text-center\\\">\\n            <ion-chip color=\\\"light\\\">Game Details</ion-chip>\\n\\n            <div class=\\\"ion-text-center\\\">\\n                <ion-text color=\\\"light\\\" style=\\\"margin-top: 10px\\\">\\n                    <ion-icon name=\\\"location\\\"></ion-icon>\\n                    Location: {{ this.game.location }}\\n                    <br>\\n                </ion-text>\\n            </div>\\n\\n            <div class=\\\"ion-text-center\\\">\\n                <ion-text color=\\\"light\\\" style=\\\"margin-top: 10px\\\">\\n                    <ion-icon name=\\\"calendar-outline\\\"></ion-icon>\\n                    Date: {{ this.game.date }}\\n                    <br>\\n                </ion-text>\\n            </div>\\n\\n            <div class=\\\"ion-text-center\\\">\\n                <ion-text color=\\\"light\\\" style=\\\"margin-top: 10px\\\">\\n                    <ion-icon name=\\\"time-outline\\\"></ion-icon>\\n                    Time: {{ this.game.time }}\\n                    <br>\\n                </ion-text>\\n            </div>\\n\\n            <br>\\n\\n            <ion-chip color=\\\"light\\\">Add Friends if any</ion-chip>\\n\\n            <!-- List of friends -->\\n            <ion-list *ngFor=\\\"let friend of friends; let i = index\\\">\\n                <ion-item>\\n                    <ion-label position=\\\"floating\\\">Friend {{ i + 1 }}</ion-label>\\n                    <ion-input [value]=\\\"friend.name\\\" (input)=\\\"updateFriendName(i, $event.target.value)\\\" name=\\\"friendName{{ i }}\\\" placeholder=\\\"Input friend name\\\" required></ion-input>\\n                    <ion-button fill=\\\"clear\\\" color=\\\"danger\\\" (click)=\\\"removeFriend(i)\\\">\\n                        <ion-icon name=\\\"close-circle\\\"></ion-icon>\\n                        Remove\\n                    </ion-button>\\n                </ion-item>\\n            </ion-list>\\n\\n            <br>\\n\\n            <ion-button (click)=\\\"addFriendButton()\\\" style=\\\"margin-top: 10px;\\\">Add Friend</ion-button>\\n\\n            <br> <br>\\n\\n            <ion-chip color=\\\"light\\\">Price</ion-chip>\\n\\n            <div class=\\\"ion-text-center\\\">\\n                <ion-text color=\\\"light\\\" style=\\\"margin-top: 10px\\\">\\n                    <ion-icon name=\\\"cash-outline\\\"></ion-icon>\\n                    You will be paying: {{ this.game.price }} per person.\\n                    <br>\\n                </ion-text>\\n            </div>\\n\\n            <br>\\n\\n            <div *ngIf=\\\"friends.length > 0\\\">\\n                <ion-chip color=\\\"light\\\">Total Calculated Price</ion-chip>\\n\\n                <div class=\\\"ion-text-center\\\">\\n                    <ion-text color=\\\"light\\\" style=\\\"margin-top: 10px\\\">\\n                        <ion-icon name=\\\"cash-outline\\\"></ion-icon>\\n                        Total calculated price would be: RM{{ this.calculatedFees }} which includes yours as well.\\n                        <br>\\n                    </ion-text>\\n                </div>\\n            </div>\\n\\n\\n        </div>\\n\\n        <div class=\\\"ion-text-center\\\" style=\\\"margin-top: 20px; display: flex; align-items: center; margin-left: 10%\\\">\\n            <ion-checkbox formControlName=\\\"agree\\\" color=\\\"light\\\" style=\\\"margin-right: 8px;\\\"></ion-checkbox>\\n            I agree to the terms and conditions\\n        </div>\\n\\n        <div class=\\\"ion-text-center\\\" style=\\\"margin-top: 20px\\\">\\n            <ion-button color=\\\"danger\\\" type=\\\"submit\\\" [disabled]=\\\"!paymentForm.valid\\\">\\n                Pay Now\\n            </ion-button>\\n        </div>\\n\\n\\n    </form>\\n</ion-content>\\n\";","import { Component, OnInit } from '@angular/core';\nimport { ModalController, NavParams } from \"@ionic/angular\";\nimport { FormBuilder, FormGroup, Validators } from \"@angular/forms\";\nimport { AngularFirestore } from \"@angular/fire/compat/firestore\";\nimport { Auth, user } from \"@angular/fire/auth\";\nimport { Subscription } from \"rxjs\";\nimport firebase from \"firebase/compat\";\nimport { ToastService } from \"../../../services/toast/toast.service\";\nimport User = firebase.User;\n\n@Component({\n    selector: 'app-payment',\n    templateUrl: './payment.page.html',\n    styleUrls: ['./payment.page.scss'],\n})\nexport class PaymentPage implements OnInit {\n\n    game: any\n    username: string\n\n    friends: any[] = []; // Initialize it as an empty array\n\n    user$ = user(this.auth);\n    userSubscription: Subscription;\n\n    paymentForm: FormGroup;\n\n    calculatedFees: number = 0\n    spotsLeft: number = 0\n\n    constructor(\n        private modalController: ModalController,\n        private formBuilder: FormBuilder,\n        private navParams: NavParams,\n        private firestore: AngularFirestore,\n        private auth: Auth,\n        private toastService: ToastService,\n    ) {\n\n        this.paymentForm = this.formBuilder.group({\n            agree: [false, Validators.requiredTrue],\n        });\n\n        // Retrieve username from Firebase Auth displayName field\n        this.userSubscription = this.user$.subscribe((aUser: User | null) => {\n            this.username = aUser.displayName\n        })\n\n    }\n\n    async ngOnInit() {\n\n        // Retrieve the 'game' object passed from the calling component\n        this.game = this.navParams.get('game');\n\n        // Retrieve the 'spotsLeft' object passed from the calling component\n        this.spotsLeft = this.navParams.get('spotsLeft');\n\n        console.log('THE SPOTS LEFT:', this.spotsLeft)\n\n        // Initialise calculatedFees first\n        this.calculatedFees = this.extractNumberFromPrice(this.game.price)\n\n    }\n\n    cancel() {\n\n        // Dismiss modal\n        this.modalController.dismiss();\n    }\n\n    updateFriendName(index: number, newName: string) {\n\n        console.log('Index position: ', index)\n\n        // Set the friends array object name - with onChange input\n        if (this.friends[index]) {\n            this.friends[index].name = newName;\n        }\n\n        console.log('The friends array object: ', this.friends)\n\n    }\n\n\n    async addPlayerToGame(gameId: any) {\n\n        // If payment form is valid, proceed\n        if (this.paymentForm.valid) {\n\n            console.log('Total friends: ', this.friends)\n\n            console.log('THIS GAME ID:::', gameId)\n\n            // TODO:: Make payment system gateway here - to finish off the deal. Make payment processing here first to book slot\n\n            try {\n\n                // Retrieve game reference object\n                const gameRef = this.firestore.collection('games').doc(gameId);\n                const playerListRef = gameRef.collection('playerList');\n\n                // TODO:: Have to set paymentStatus == PAID once Stripe payment is released.\n\n                // This is for Personal User Setting - his own account to be added\n                const playerData = {\n                    playerName: this.username,\n                    timestamp: new Date(),\n                    paymentStatus: 'PAID'\n                };\n\n                await playerListRef.add(playerData);\n\n                // If there are some friends involved;\n                if (this.friends.length > 0) {\n\n                    // Iterate through the friends array\n                    for (const friend of this.friends) {\n\n                        // Create a friend object for each friend\n                        const friendData = {\n                            playerName: friend.name,\n                            timestamp: new Date(),\n                            paymentStatus: 'PAID'\n                        };\n\n                        // Add the friend object to the 'playerList' collection\n                        await playerListRef.add(friendData);\n                    }\n\n                }\n\n                await this.toastService.presentToast('Players Added Successfully', `Players has been added to the session.`, 'top', 'success', 3500);\n\n                // Dismiss modal\n                await this.modalController.dismiss();\n\n            } catch (error) {\n                console.error('Error adding player to game: ', error);\n            }\n\n        }\n\n\n    }\n\n    addFriendButton() {\n\n        // Add an empty friend object to the friends array\n        this.friends.push(\n            {\n                name: '',\n                timestamp: new Date()\n            }\n        );\n\n        // Calculate the total price and update calculatedFees\n        this.calculatedFees = this.calculateTotalPrice();\n    }\n\n    removeFriend(index: number) {\n\n        this.friends.splice(index, 1);\n\n        console.log('This.friends.length: ', this.friends.length)\n\n        // Calculate the total price and update calculatedFees\n        this.calculatedFees = this.calculateTotalPrice();\n    }\n\n    calculateTotalPrice(): number {\n\n        const basePrice = this.extractNumberFromPrice(this.game.price);\n\n        if (this.friends.length > 0) {\n            this.calculatedFees = basePrice * (1 + this.friends.length);\n        } else {\n            this.calculatedFees = basePrice; // Set it to the base price if no friends are added\n        }\n\n        return this.calculatedFees;\n    }\n\n    // Function to extract the numeric part from a string like 'RM25'\n    extractNumberFromPrice(priceString: string): number {\n        // Use regex to match the numeric part of the string\n        const match = priceString.match(/\\d+/);\n\n        // If a match is found, parse it to an integer; otherwise, return 0\n        return match ? parseInt(match[0], 10) : 0;\n    }\n\n}\n"],"names":[],"sourceRoot":"webpack:///"}