{"version":3,"file":"src_app_pages_secure_profile_edit_edit_module_ts.js","mappings":"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","sources":["./src/app/pages/secure/profile/edit/edit.page.html","./src/app/pages/secure/profile/edit/edit-routing.module.ts","./src/app/pages/secure/profile/edit/edit.module.ts","./src/app/pages/secure/profile/edit/edit.page.ts"],"sourcesContent":["export default \"<ion-header collapse=\\\"fade\\\" [translucent]=\\\"true\\\">\\r\\n    <ion-toolbar>\\r\\n        <ion-buttons slot=\\\"start\\\">\\r\\n            <ion-back-button text=\\\"Back\\\" defaultHref=\\\"/profile\\\"></ion-back-button>\\r\\n        </ion-buttons>\\r\\n        <ion-title>\\r\\n            Profile\\r\\n        </ion-title>\\r\\n    </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content [fullscreen]=\\\"true\\\">\\r\\n\\r\\n    <div class=\\\"hero hero-light-gradient\\\">\\r\\n        <ion-avatar>\\r\\n            <ion-icon class=\\\"avatar-icon-placeholder\\\" name=\\\"person-circle\\\" color=\\\"tertiary\\\">\\r\\n            </ion-icon>\\r\\n        </ion-avatar>\\r\\n        <ion-button class=\\\"ion-button-small\\\" color=\\\"primary\\\" fill=\\\"clear\\\" (click)=\\\"updateProfilePicture()\\\">\\r\\n            Update profile picture\\r\\n        </ion-button>\\r\\n    </div>\\r\\n\\r\\n    <div class=\\\"ion-padding\\\">\\r\\n\\r\\n        <form class=\\\"form-default\\\" [formGroup]=\\\"edit_profile_form\\\" (submit)=\\\"submit()\\\">\\r\\n\\r\\n            <ion-list class=\\\"item-card-list\\\" lines=\\\"none\\\">\\r\\n                <ion-item>\\r\\n                    <ion-label color=\\\"tertiary\\\" position=\\\"stacked\\\">Name</ion-label>\\r\\n                    <ion-input formControlName=\\\"username\\\" placeholder=\\\"Name\\\" [ngModel]=\\\"username\\\"></ion-input>\\r\\n                </ion-item>\\r\\n            </ion-list>\\r\\n\\r\\n            <p class=\\\"list-description\\\">Info: Upon clicking save, username will be changed.</p>\\r\\n\\r\\n            <br>\\r\\n\\r\\n            <div class=\\\"ion-text-center\\\">\\r\\n                <ion-button expand=\\\"block\\\" type=\\\"submit\\\" shape=\\\"round\\\">\\r\\n                    Save\\r\\n                </ion-button>\\r\\n            </div>\\r\\n\\r\\n        </form>\\r\\n\\r\\n        <hr class=\\\"hr-medium\\\">\\r\\n\\r\\n        <ion-list class=\\\"list-custom\\\" lines=\\\"full\\\" (click)=\\\"deleteAccount()\\\">\\r\\n            <ion-item button detail=false>\\r\\n                <ion-icon slot=\\\"start\\\" color=\\\"danger\\\" name=\\\"trash-outline\\\"></ion-icon>\\r\\n                <ion-label color=\\\"danger\\\">\\r\\n                    <h3>Delete Account</h3>\\r\\n                </ion-label>\\r\\n            </ion-item>\\r\\n        </ion-list>\\r\\n\\r\\n    </div>\\r\\n\\r\\n</ion-content>\\r\\n\";","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { EditPage } from './edit.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: EditPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class EditPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { EditPageRoutingModule } from './edit-routing.module';\r\n\r\nimport { EditPage } from './edit.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    EditPageRoutingModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [EditPage]\r\n})\r\nexport class EditPageModule {}\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { ActionSheetController, AlertController, NavController } from '@ionic/angular';\r\nimport { ToastService } from 'src/app/services/toast/toast.service';\r\nimport { AuthService } from \"../../../../services/auth/auth.service\";\r\nimport { Auth, deleteUser, getAuth, user } from \"@angular/fire/auth\";\r\nimport { Subscription } from \"rxjs\";\r\nimport firebase from \"firebase/compat\";\r\nimport { Router } from \"@angular/router\";\r\nimport { deleteDoc, doc, Firestore } from \"@angular/fire/firestore\";\r\nimport { AngularFirestore } from \"@angular/fire/compat/firestore\";\r\nimport User = firebase.User;\r\n\r\n@Component({\r\n    selector: 'app-edit',\r\n    templateUrl: './edit.page.html',\r\n    styleUrls: ['./edit.page.scss'],\r\n})\r\nexport class EditPage implements OnInit, OnDestroy {\r\n\r\n    user$ = user(this.auth);\r\n    userSubscription: Subscription;\r\n\r\n    edit_profile_form: FormGroup;\r\n    submit_attempt: boolean = false;\r\n\r\n    username: any\r\n\r\n    constructor(\r\n        private formBuilder: FormBuilder,\r\n        private toastService: ToastService,\r\n        private navController: NavController,\r\n        private actionSheetController: ActionSheetController,\r\n        private authService: AuthService,\r\n        private auth: Auth,\r\n        private router: Router,\r\n        private alertController: AlertController,\r\n        private firestore: Firestore,\r\n        private afs: AngularFirestore\r\n    ) {\r\n\r\n        this.userSubscription = this.user$.subscribe((aUser: User | null) => {\r\n            this.username = aUser.displayName\r\n        })\r\n    }\r\n\r\n    ngOnInit() {\r\n\r\n        // Setup form\r\n        this.edit_profile_form = this.formBuilder.group({\r\n            username: ['', Validators.required],\r\n        });\r\n\r\n    }\r\n\r\n    // Update profile picture\r\n    async updateProfilePicture() {\r\n\r\n        const actionSheet = await this.actionSheetController.create({\r\n            header: 'Choose existing picture or take new',\r\n            cssClass: 'custom-action-sheet',\r\n            buttons: [\r\n                {\r\n                    text: 'Choose from gallery',\r\n                    icon: 'images',\r\n                    handler: () => {\r\n                        // Put in logic ...\r\n                    }\r\n                },\r\n                {\r\n                    text: 'Take picture',\r\n                    icon: 'camera',\r\n                    handler: () => {\r\n                        // Put in logic ...\r\n                    }\r\n                }, {\r\n                    text: 'Cancel',\r\n                    icon: 'close',\r\n                    role: 'cancel'\r\n                }]\r\n        });\r\n        await actionSheet.present();\r\n    }\r\n\r\n    // Submit form\r\n    submit() {\r\n\r\n        this.submit_attempt = true;\r\n\r\n        // If form valid\r\n        if (this.edit_profile_form.valid) {\r\n\r\n            // Save form ...\r\n            this.authService.updateProfileName(this.edit_profile_form.get('username').value)\r\n\r\n            // Display success message and go back\r\n            this.toastService.presentToast('Success', 'Username has been saved', 'top', 'success', 2000);\r\n\r\n            // Move controller back to profile page\r\n            this.router.navigateByUrl('/profile', {replaceUrl: true});\r\n\r\n        } else {\r\n\r\n            // Display error message\r\n            this.toastService.presentToast('Error', 'Please fill in all required fields', 'top', 'danger', 2000);\r\n        }\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.userSubscription.unsubscribe();\r\n    }\r\n\r\n    async deleteAccount() {\r\n\r\n        try {\r\n            const alert = await this.alertController.create({\r\n                cssClass: 'custom-alert',\r\n                header: 'Delete this account permanently?',\r\n                message: 'This action cannot be undone.',\r\n                buttons: [\r\n                    {\r\n                        text: 'Delete account',\r\n                        cssClass: 'danger',\r\n                        handler: async () => {\r\n\r\n                            // Deletion of Firebase Auth Object - which is the current user\r\n                            const auth = getAuth();\r\n                            const user = auth.currentUser;\r\n\r\n                            // Delete username in Firestore Database 'users' collection\r\n                            // Get a reference to the users collection, then the document, and valueChanges to retrieve the document id.\r\n                            const userDocument$ =\r\n                                this.afs.collection('users', ref =>\r\n                                    ref.where('uid', '==', user.uid)).valueChanges({idField: 'id'}\r\n                                );\r\n\r\n                            // After retrieval of collections, then only observable has to be subscribed in order to retrieve values\r\n                            userDocument$.subscribe((userDoc) => {\r\n\r\n                                // If there is data related\r\n                                if (userDoc.length > 0) {\r\n\r\n                                    // Assign userData with first item\r\n                                    const userData = userDoc[0];\r\n\r\n                                    // Deletes operation on the 'users/{document_id}' of the selected user\r\n                                    this.deleteUser(userData.id)\r\n\r\n                                    console.log('Successfully deleted the user in Angular Firestore: ', userData.id)\r\n\r\n                                }\r\n                            });\r\n\r\n                            // Delete auth user record in Authentication tab - Firebase\r\n                            deleteUser(user).then(async () => {\r\n                                // User deleted.\r\n                                await this.toastService.presentToast('Success', 'User successfully deleted', 'top', 'success', 2000);\r\n\r\n                                await this.router.navigateByUrl('/signin', {replaceUrl: true});\r\n\r\n                            }).catch(async (error) => {\r\n                                // An error occurred\r\n                                await this.toastService.presentToast('Error', `Message: ${error}`, 'top', 'danger', 2000);\r\n\r\n                            });\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        text: 'Cancel',\r\n                        role: 'cancel',\r\n                        cssClass: 'cancel'\r\n                    }\r\n                ]\r\n            });\r\n\r\n            await alert.present();\r\n\r\n        } catch (ex) {\r\n            console.log(\"Error: \", ex)\r\n            await this.toastService.presentToast('Error', `Message: ${ex}`, 'top', 'danger', 2000);\r\n        }\r\n\r\n\r\n    }\r\n\r\n    deleteUser(userId: any) {\r\n        const userRef = doc(this.firestore, `users/${userId}`);\r\n        return deleteDoc(userRef);\r\n    }\r\n\r\n}\r\n"],"names":[],"sourceRoot":"webpack:///"}